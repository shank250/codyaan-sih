<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> -->
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="chatbot.css">
</head>

<body>
    <!-- {% endblock %} -->
    <!-- {% block content %} -->
    <nav>
        <div class="nav_logo">
            <img src="assets/logo.png" alt="logo">
            <p>Codyaan</p>
        </div>
        <div class="nav_list">
            <div>Home</div>
            <div class="active">Rasie a complaint</div>
            <div>Dashboard</div>
            <div>Profile</div>
        </div>
    </nav>
    <section>
        <div class="sidebar">
            <h2>History</h2>
            <div class="graviences">
                <form>
                    <p class="complaint_name">Lorem ipsum dolor sit amet consectetur </p>
                    <status><img src="assets/peding.png" alt=""></status>
                </form>
            </div>
        </div>
        <div class="chatbot chat-container">
            <!-- {% if user.is_authenticated %} -->
            <h3 class="card-header">Welcome, {{user.username}}</h3>
            <!-- {% else %} -->

            <!-- {% endif %} -->
            <div class="card-body messages-box" id="message_box">
                <ul class="list-unstyled messages-list" messages-list>
                    <li class="message received">
                        <div class="message-text">
                            <div class="message-sender">
                                <b>Hello</b>
                            </div>
                            <div class="message-content">
                                Hi {{user.username}}, I am your AI Chatbot, you can ask me anything.
                            </div>
                        </div>
                    </li>

                    <!-- {% for chat in chats %} -->
                    <!-- {% if chat.user == request.user %} -->

                    <li class="message sent">
                        <div class="message-text">
                            <div class="message-sender">
                                <b>You</b>
                            </div>
                            <div class="message-content">
                                <!-- {{chat.message}} -->
                            </div>
                        </div>
                    </li>

                    <li class="message received">
                        <div class="message-text">
                            <div class="message-sender">
                                <b>AI Chatbot</b>
                            </div>
                            <div class="message-content">
                                <!-- {{chat.response}} -->
                            </div>
                        </div>
                    </li>
                    <!-- {% endif %} -->
                    <!-- {% endfor %} -->
                </ul>
                <input type="text" id="show" style="visibility: hidden;">
            </div>
            <div class="documents">
                <div class="document">
                    <input type="file" style="display: none;" id="img" alt=""><label for="img" class="img"></label>
                    <p>Aadhar</p>
                </div>
            </div>
            <form class="message-form">
                <!-- {%csrf_token%} -->
                <div class="input-group">
                    <div class="input">
                        <input type="text" class="form-control message-input" placeholder="Type your message">
                        <div>
                            <p><button id="record" class=""></button></p>
                        </div>
                    </div>
                    <div class="input-group-append">
                        <button type="submit" class="btn btn-primary btn-send">Send</button>
                    </div>
                </div>
            </form>
        </div>
    </section>
    <!-- {% block content %}{% endblock %} -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- {% block scripts %}{% endblock %} -->
    <script>
        const messagesList = document.querySelector('.messages-list');
        const messageForm = document.querySelector('.message-form');
        const messageInput = document.querySelector('.message-input');
        // document.addEventListener("keydown", () => {
        //     messageInput.focus();
        // })

        messageForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const message = messageInput.value.trim();
            if (message.length === 0) {
                return;
            }
            const messageItem = document.createElement('li');
            messageItem.classList.add('message', 'sent');
            messageItem.innerHTML = `
              <div class="message-text">
                  <div class="message-sender">
                      <b>You</b>
                  </div>
                  <div class="message-content">
                      ${message}
                  </div>
              </div>`;
            messagesList.appendChild(messageItem);
            messageInput.value = '';
            fetch('', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({
                    // 'csrfmiddlewaretoken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'message': message
                })
            })
                .then(response => response.json())
                .then(data => {
                    const response = data.response;
                    const messageItem = document.createElement('li');
                    messageItem.classList.add('message', 'received');
                    messageItem.innerHTML = `
              <div class="message-text">
                  <div class="message-sender">
                    <b>AI Chatbot</b>
                  </div>
                  <div class="message-content">
                      ${response}
                  </div>
              </div>
                `;
                    messagesList.appendChild(messageItem);
                });
            var child = document.getElementById("show").getBoundingClientRect().top;
            document.getElementById("message_box").scrollTop = child;
        });
        document.getElementById("record").onclick = ()=>{
            document.getElementById("src").setAttribute("src","voice.js");
        }
    </script>
    <script id="src"></script>
    <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <!-- {% endblock %} -->
</body>

</html>